<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>USDTãƒ»BEP20 ä¸€æ¬¾æ›´å¥½ç”¨çš„ä¸ªäººUSDTæ”¶æ¬¾ç½‘å…³ BEpusdt</title>
    <link rel="shortcut icon" href="/img/tether.svg" />
    <link rel="stylesheet" href="/css/usdt.min.css">
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.qrcode_1.0.min.js"></script>
</head>

<body>
    <div class="payment-container">
        <div class="crypto-icon">USDT</div>
        <h1 class="payment-title">USDT æ”¯ä»˜</h1>
        <p class="payment-subtitle">
            <span class="status-indicator"></span>
            è¯·ä½¿ç”¨ å¸å®‰æ™ºèƒ½é“¾<strong>(BSC)</strong> è¿›è¡Œè½¬è´¦
            <span class="network-badge">BEP20</span>
        </p>
        <div class="order-info">
            <div class="order-item">
                <span class="order-label">è½¬è´¦é‡‘é¢:</span>
                <span class="order-value amount-highlight" id="payAmount">{{.amount}} USDT</span>
            </div>
            <div class="order-item">
                <span class="order-label">å•†æˆ·è®¢å•:</span>
                <span class="order-value" id="orderNumber">{{.order_id}}</span>
            </div>
        </div>
        <div class="countdown-banner">
            <div class="countdown-content">
                <div class="countdown-info">
                    <div class="countdown-title">â° æ”¯ä»˜å€’è®¡æ—¶</div>
                    <div class="countdown-subtitle">è¯·åœ¨æ—¶é—´å†…å®Œæˆè½¬è´¦</div>
                </div>
                <div class="countdown-timer" id="countdown">
                    <div class="time-unit">
                        <span class="time-number" id="minutes">15</span>
                        <span class="time-label">åˆ†</span>
                    </div>
                    <span class="time-separator">:</span>
                    <div class="time-unit">
                        <span class="time-number" id="seconds">00</span>
                        <span class="time-label">ç§’</span>
                    </div>
                </div>
            </div>
        </div>
        <div class="qr-section">
            <div class="qr-code" id="qrcode"></div>
            <div class="address-section">
                <div class="address-label">æ”¶æ¬¾åœ°å€ (BEP20 ç½‘ç»œ)</div>
                <div class="address-text" id="walletAddress">{{.address}}</div>
                <button class="copy-btn" onclick="copyAddress()">å¤åˆ¶åœ°å€</button>
            </div>
        </div>
        <div class="instructions">
            <h4>ğŸ“‹ è½¬è´¦è¯´æ˜</h4>
            <ol>
                <li>å¿…é¡»ä½¿ç”¨ <strong>BEP20 ç½‘ç»œ</strong> è¿›è¡Œè½¬è´¦</li>
                <li>è½¬è´¦å®Œæˆåç³»ç»Ÿä¼šè‡ªåŠ¨ç¡®è®¤åˆ°è´¦</li>
                <li>è½¬è´¦é‡‘é¢å¿…é¡»ä¸æ˜¾ç¤ºé‡‘é¢å®Œå…¨ä¸€è‡´</li>
                <li>å¦‚æœæœ‰å…¶å®ƒç–‘é—® è¯·è”ç³»å®¢æœå¤„ç†</li>
            </ol>
        </div>
        <div class="footer-info">
            <div class="project-info">
                <span class="powered-by">Powered by</span>
                <a href="https://github.com/v03413/BEpusdt" target="_blank" class="project-link">
                    <strong>BEpusdt</strong>
                </a>
                <span class="open-source">ä¼˜é›…å¼€æº</span>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let countdownTimer = null;
        let statusCheckTimer = null;
        let totalSeconds = '{{.expire }}';

        // ç”ŸæˆäºŒç»´ç 
        function generateQRCode() {
            const qrContainer = document.getElementById('qrcode');
            const containerWidth = qrContainer.offsetWidth;
            const qrSize = Math.min(containerWidth - 10, 150); // ç•™å‡º10pxçš„è¾¹è·

            $('#qrcode').qrcode({
                text: "{{.address}}",
                width: qrSize,
                height: qrSize,
                foreground: "#000000",
                background: "#ffffff",
                typeNumber: -1
            });
        }

        // å¤åˆ¶åœ°å€
        function copyAddress() {
            const address = document.getElementById('walletAddress').textContent;
            navigator.clipboard.writeText(address).then(function () {
                const btn = document.querySelector('.copy-btn');
                const originalText = btn.textContent;
                btn.textContent = 'å·²å¤åˆ¶!';
                btn.style.background = '#48bb78';

                setTimeout(function () {
                    btn.textContent = originalText;
                    btn.style.background = '#667eea';
                }, 2000);
            }).catch(function (err) {
                console.error('å¤åˆ¶å¤±è´¥: ', err);
                // é™çº§æ–¹æ¡ˆ
                const textArea = document.createElement('textarea');
                textArea.value = address;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const btn = document.querySelector('.copy-btn');
                    const originalText = btn.textContent;
                    btn.textContent = 'å·²å¤åˆ¶!';
                    btn.style.background = '#48bb78';
                    setTimeout(function () {
                        btn.textContent = originalText;
                        btn.style.background = '#667eea';
                    }, 2000);
                } catch (err) {
                    alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶åœ°å€');
                }
                document.body.removeChild(textArea);
            });
        }

        // å€’è®¡æ—¶
        function startCountdown() {
            const minutesEl = document.getElementById('minutes');
            const secondsEl = document.getElementById('seconds');

            function updateDisplay() {
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;

                if (totalSeconds <= 0) {
                    minutesEl.textContent = '00';
                    secondsEl.textContent = '00';
                } else {
                    minutesEl.textContent = minutes.toString().padStart(2, '0');
                    secondsEl.textContent = seconds.toString().padStart(2, '0');
                }

                // å½“å‰©ä½™æ—¶é—´å°‘äº5åˆ†é’Ÿæ—¶ï¼Œå€’è®¡æ—¶å˜çº¢è‰²
                if (totalSeconds <= 300) { // 5åˆ†é’Ÿ = 300ç§’
                    document.querySelector('.countdown-banner').style.background = 'linear-gradient(135deg, #ff4757, #ff3838)';
                }

                // å½“å‰©ä½™æ—¶é—´å°‘äº1åˆ†é’Ÿæ—¶ï¼Œæ·»åŠ ç´§æ€¥é—ªçƒæ•ˆæœ
                if (totalSeconds <= 60) {
                    document.querySelector('.countdown-banner').style.animation = 'urgentBlink 1s infinite';
                }
            }

            countdownTimer = setInterval(function () {
                totalSeconds--;
                updateDisplay();

                if (totalSeconds <= 0) {
                    clearInterval(countdownTimer);
                    clearInterval(statusCheckTimer);
                }
            }, 1000);

            // åˆå§‹åŒ–æ˜¾ç¤º
            updateDisplay();
        }

        // æ”¯ä»˜è¶…æ—¶
        function showTimeoutMessage() {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
            `;

            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 12px;
                text-align: center;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            `;


            modal.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 20px;">â°</div>
                <h3 style="color: #e53e3e; margin-bottom: 15px;">æ”¯ä»˜æ—¶é—´å·²è¿‡æœŸ</h3>
                <p style="color: #666; margin-bottom: 25px; line-height: 1.5;">
                    å¾ˆæŠ±æ­‰ï¼Œæ”¯ä»˜æ—¶é—´å·²è¶…æ—¶ã€‚<br>
                    è¯·é‡æ–°å‘èµ·æ”¯ä»˜æˆ–è”ç³»å®¢æœå¤„ç†ã€‚
                </p>
                <button onclick="location.href='{{.return_url}}'" style="
                    background: #667eea;
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                    margin-right: 10px;
                ">è¿”å›å•†æˆ·å¹³å°</button>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);
        }

        // æ”¯ä»˜æˆåŠŸ
        function showSuccessMessage(data) {
            const overlay = document.createElement('div');
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 9999;
            `;

            const modal = document.createElement('div');
            modal.style.cssText = `
                background: white;
                padding: 30px;
                border-radius: 12px;
                text-align: center;
                max-width: 400px;
                width: 90%;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            `;

            modal.innerHTML = `
                <div style="font-size: 48px; margin-bottom: 20px;">âœ…</div>
                <h3 style="color: #48bb78; margin-bottom: 15px;">æ”¯ä»˜æˆåŠŸï¼</h3>
                <p style="color: #666; margin-bottom: 20px; line-height: 1.5;">
                    æ‚¨çš„æ”¯ä»˜å·²ç¡®è®¤ï¼Œäº¤æ˜“å“ˆå¸Œï¼š<br>
                    <code style="background: #e6f0fa; color: #2563eb; padding: 4px 8px; border-radius: 4px; font-size: 12px; word-break: break-all;">
                        ${data.trade_hash || 'å¤„ç†ä¸­...'}
                    </code>
                </p>
                <button onclick="location.href='${data.return_url || '/'}'" style="
                    background: #48bb78;
                    color: white;
                    border: none;
                    padding: 12px 24px;
                    border-radius: 6px;
                    cursor: pointer;
                    font-size: 14px;
                ">è¿”å›å•†æˆ·å¹³å°</button>
            `;

            overlay.appendChild(modal);
            document.body.appendChild(overlay);

            // æ¸…é™¤å®šæ—¶å™¨
            if (countdownTimer) clearInterval(countdownTimer);
            if (statusCheckTimer) clearInterval(statusCheckTimer);
        }

        // æ£€æŸ¥æ”¯ä»˜çŠ¶æ€
        function checkPaymentStatus() {
            $.ajax({
                type: "GET",
                dataType: "json",
                url: "/pay/check-status/{{.trade_id}}",
                success: function (data) {
                    if (data.status === 1) {

                        return setTimeout(checkPaymentStatus, 5000);  // ç­‰å¾…æ”¯ä»˜
                    }
                    if (data.status === 2) {

                        return showSuccessMessage(data);  // æ”¯ä»˜æˆåŠŸ
                    }
                    if (data.status === 3) {

                        return showTimeoutMessage(); // æ”¯ä»˜è¶…æ—¶
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', function () {
            generateQRCode();
            startCountdown();

            setTimeout(checkPaymentStatus, 2000);
        });
    </script>
</body>

</html>